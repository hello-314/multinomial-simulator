<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‹¤í•­ë¶„í¬ ì‹œë®¬ë ˆì´í„°</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { margin: 5px; padding: 5px; }
    button { margin: 10px; padding: 8px; }
    .prob-inputs { margin: 10px 0; }
  </style>
</head>
<body>
  <h2>ğŸ² ë‹¤í•­ë¶„í¬ ì‹œë®¬ë ˆì´í„° (ì—¬ëŸ¬ ê´€ì‹¬ ê°’ ì¶”ì )</h2>

  <label>ê²°ê³¼ ì¢…ë¥˜ ìˆ˜: <input type="number" id="categoryCount" value="3" min="2" max="10"></label>
  <button onclick="generateProbInputs()">í™•ë¥  ì…ë ¥ì°½ ìƒì„±</button>

  <div class="prob-inputs" id="probInputs"></div>

  <label>ì‹œí–‰ íšŸìˆ˜ (í•œ ë²ˆì˜ ì‹¤í—˜ì—ì„œ): <input type="number" id="trials" value="10"></label><br>
  <label>ë°˜ë³µ íšŸìˆ˜ (ì „ì²´ ì‹¤í—˜ íšŸìˆ˜): <input type="number" id="repeats" value="500"></label><br>

  <label>ê´€ì‹¬ ê°’ë“¤ (ì‰¼í‘œë¡œ êµ¬ë¶„, ì˜ˆ: 1,2): <input type="text" id="targetValues" value="1"></label><br>

  <button onclick="runMultinomialSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>

  <h3>ğŸ”¢ ê²°ê³¼: ê´€ì‹¬ ê°’ë“¤ì´ ë‚˜ì˜¨ íšŸìˆ˜ ë¶„í¬</h3>
  <pre id="result"></pre>
  <canvas id="chart" width="800" height="400"></canvas>

  <script>
    function generateProbInputs() {
      const count = parseInt(document.getElementById("categoryCount").value);
      const container = document.getElementById("probInputs");
      container.innerHTML = '';
      for (let i = 0; i < count; i++) {
        container.innerHTML += `ì¢…ë¥˜ ${i + 1} í™•ë¥ : <input type="number" step="0.01" id="prob${i}" value="${(1/count).toFixed(2)}"><br>`;
      }
    }

    function runMultinomialSimulation() {
      const count = parseInt(document.getElementById("categoryCount").value);
      const n = parseInt(document.getElementById("trials").value);
      const repeats = parseInt(document.getElementById("repeats").value);
      const targets = document.getElementById("targetValues").value.split(',').map(v => parseInt(v.trim()) - 1);

      // í™•ë¥  ì…ë ¥ ë°›ê¸°
      let probs = [];
      for (let i = 0; i < count; i++) {
        probs.push(parseFloat(document.getElementById(`prob${i}`).value));
      }

      const totalProb = probs.reduce((a, b) => a + b, 0);
      if (Math.abs(totalProb - 1) > 0.001) {
        alert("í™•ë¥ ì˜ í•©ì€ 1ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }

      // ê´€ì‹¬ ê°’ë“¤ì˜ ë“±ì¥ íšŸìˆ˜ ë¹ˆë„ í…Œì´ë¸” ì´ˆê¸°í™”
      let freq = Array(n + 1).fill(0);

      for (let i = 0; i < repeats; i++) {
        let countTarget = 0;
        for (let j = 0; j < n; j++) {
          let r = Math.random();
          let cumulative = 0;
          for (let k = 0; k < count; k++) {
            cumulative += probs[k];
            if (r < cumulative) {
              if (targets.includes(k)) countTarget++;
              break;
            }
          }
        }
        freq[countTarget]++;
      }

      // ê²°ê³¼ ì¶œë ¥
      let resultText = '';
      freq.forEach((val, i) => {
        if (val > 0) resultText += `${i}ë²ˆ ë“±ì¥: ${val}íšŒ\n`;
      });
      document.getElementById("result").textContent = resultText;

      // ê·¸ë˜í”„ ì¶œë ¥
      const ctx = document.getElementById('chart').getContext('2d');
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: freq.map((_, i) => `${i}ë²ˆ`),
          datasets: [{
            label: `ê´€ì‹¬ ê°’ë“¤(${targets.map(x => x + 1).join(', ')})ì˜ ë“±ì¥ íšŸìˆ˜ ë¶„í¬`,
            data: freq,
            backgroundColor: 'rgba(153, 102, 255, 0.6)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: 'ê´€ì‹¬ ê°’ ë“±ì¥ íšŸìˆ˜' } },
            y: { beginAtZero: true, title: { display: true, text: 'ë¹ˆë„' } }
          }
        }
      });
    }

    window.onload = generateProbInputs;
  </script>
</body>
</html>
